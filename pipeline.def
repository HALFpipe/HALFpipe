Bootstrap: docker
From: poldracklab/fmriprep:20.1.0rc2

%setup
  mkdir -p ${SINGULARITY_ROOTFS}/root/src/pipeline
  mkdir -p ${SINGULARITY_ROOTFS}/ext

%files
  . /root/src/pipeline

%post
  export PATH=/usr/local/miniconda/bin:$PATH
  
  pip install --upgrade pip
  
  cd /root/src/pipeline && \
    pip install .[all] && \
    python postsetup.py
  
  rm -rf ~/.cache/pip
  rm -rf /root/src/pipeline

%runscript
  exec /usr/local/miniconda/bin/pipeline "$@"
  
%startscript
  exec /usr/local/miniconda/bin/pipeline "$@"
